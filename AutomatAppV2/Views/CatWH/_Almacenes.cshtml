@model AutomatApp.Entities.Models.CatWH.WHProductModel
@{
    ViewBag.Title = "_Almacenes";
}


<div class="card shadow mb-4">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <form method="get" action="@Url.Action("DescargarExcel", "CatProducto")">
            <button type="submit" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">Descargar Excel</button>
        </form>
    </div>
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Almacenes</h6>
    </div>
    <div class="card-body">
        <input type="text" id="buscarProducto" class="form-control mb-3" placeholder="Buscar producto...">
        <div class="table-responsive">
            <table class="table table-bordered" id="tablaProducto" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>WH</th>
                        <th>Descripcion</th>
                        <th>RFC</th>
                        <th>Razon_Social</th>
                        <th>Telefono_1</th>
                        <th>instalada</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <th>WH</th>
                        <th>Descripcion</th>
                        <th>RFC</th>
                        <th>Razon_Social</th>
                        <th>Telefono_1</th>
                        <th>instalada</th>
                    </tr>
                </tfoot>
                <tbody>
                    @{
                        foreach (var item in Model.WHModel)
                        {
                                        <tr>
                                            <td>@item.WH</td>
                                            <td>@item.Descripcion</td>
                                            <td>@item.RFC</td>
                                            <td>@item.Razon_Social</td>
                                            <td>@item.Telefono_1</td>
                                            <td>@(item.instalada ? "Activo" : "Inactivo")</td>                                            
                                            @if (Session["UsuarioActualiza"].ToString() == "Actualizar")
                                            {
                                                <td>
                                                    <a class="editConfiguration" style="cursor:pointer" href="~/User/Crud?id=@item.WH">
                                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-pencil-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                                                            <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
                                                        </svg>
                                                    </a>
                                                </td>
                                            }
                                        </tr>
                        }
                    }
                </tbody>
            </table>
            <div id="paginacion2" class="mt-3"></div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const filasOriginales = Array.from(document.querySelectorAll("#tablaProducto tbody tr"));
        let filas = [...filasOriginales]; // copia para filtrar
        const filasPorPagina = 10;
        let paginaActual = 1;

        function mostrarPagina(pagina) {
            const inicio = (pagina - 1) * filasPorPagina;
            const fin = inicio + filasPorPagina;

            filas.forEach((fila, index) => {
                fila.style.display = (index >= inicio && index < fin) ? "" : "none";
            });

            renderizarBotones(pagina);
        }

        function renderizarBotones(pagina) {
            const totalPaginas = Math.ceil(filas.length / filasPorPagina);
            const contenedor = document.getElementById("paginacion2");
            contenedor.innerHTML = "";

            if (totalPaginas <= 1) return;

            // Botón anterior
            const prev = document.createElement("button");
            prev.textContent = "Anterior";
            prev.className = "btn btn-outline-primary mx-1";
            prev.disabled = pagina === 1;
            prev.onclick = () => mostrarPagina(pagina - 1);
            contenedor.appendChild(prev);

            // Números de página
            for (let i = 1; i <= totalPaginas; i++) {
                const btn = document.createElement("button");
                btn.textContent = i;
                btn.className = `btn mx-1 ${i === pagina ? "btn-primary" : "btn-outline-primary"}`;
                btn.onclick = () => mostrarPagina(i);
                contenedor.appendChild(btn);
            }

            // Botón siguiente
            const next = document.createElement("button");
            next.textContent = "Siguiente";
            next.className = "btn btn-outline-primary mx-1";
            next.disabled = pagina === totalPaginas;
            next.onclick = () => mostrarPagina(pagina + 1);
            contenedor.appendChild(next);
        }

        // 🔍 Buscar productos en tiempo real
        document.getElementById("buscarProducto").addEventListener("keyup", function () {
            const filtro = this.value.toLowerCase();

            filas = filasOriginales.filter(fila =>
                fila.textContent.toLowerCase().includes(filtro)
            );

            filasOriginales.forEach(fila => fila.style.display = "none");

            paginaActual = 1;
            mostrarPagina(paginaActual);
        });

        mostrarPagina(paginaActual);
    });
</script>